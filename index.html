<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Test Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        .step-card { display: none; }
        .step-card.active { display: block; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-3xl mx-auto bg-gray-800 p-6 rounded-2xl shadow-2xl border border-gray-700">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-blue-400">Android Test Reporter</h1>
            <p class="text-gray-400 text-sm">Automated Log & Checklist Bundler</p>
        </header>

        <div class="flex justify-between mb-8 text-xs text-gray-500 uppercase tracking-widest">
            <span id="stepIndicator">Langkah 1: Identitas</span>
            <span id="autoSaveStatus" class="text-green-500 italic opacity-0 transition-opacity">Tersimpan otomatis</span>
        </div>

        <div id="step1" class="step-card active space-y-4">
            <h2 class="text-xl font-semibold border-b border-gray-700 pb-2">1. Informasi Dasar</h2>
            <div>
                <label class="block text-sm mb-1">Username Telegram</label>
                <input type="text" id="tgUser" placeholder="@username" class="w-full bg-gray-700 p-3 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm mb-1">Nama ROM/Kernel/Recovery</label>
                <input type="text" id="romName" placeholder="Contoh: LineageOS 21" class="w-full bg-gray-700 p-3 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm mb-1">Device</label>
                    <select id="deviceSelect" class="w-full bg-gray-700 p-3 rounded-lg border border-gray-600">
                        <option value="Umum">Generic / Device Lain</option>
                        <option value="POCO F3">POCO F3 (alioth)</option>
                        <option value="Redmi Note 10 Pro">Redmi Note 10 Pro (sweet)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm mb-1">Jenis Test</label>
                    <select id="testType" class="w-full bg-gray-700 p-3 rounded-lg border border-gray-600">
                        <option value="ROM">Custom ROM</option>
                        <option value="Kernel">Kernel</option>
                        <option value="Recovery">Recovery</option>
                    </select>
                </div>
            </div>
            <button onclick="nextStep(2)" class="w-full bg-blue-600 p-3 rounded-lg font-bold mt-4 hover:bg-blue-700">Lanjut ke Panduan Log</button>
        </div>

        <div id="step2" class="step-card space-y-4">
            <h2 class="text-xl font-semibold border-b border-gray-700 pb-2 text-yellow-400">2. Persiapan Log</h2>
            <div class="bg-gray-900 p-4 rounded-lg text-sm space-y-2 border-l-4 border-yellow-500 text-gray-300">
                <p><strong>Bagaimana cara ambil log?</strong></p>
                <ul class="list-disc ml-5 space-y-1">
                    <li>Gunakan ADB: <code>adb logcat -d > logcat.txt</code></li>
                    <li>Gunakan Aplikasi: <strong>MatLog</strong> atau <strong>SysLog</strong></li>
                    <li>Kernel log (Dmesg): <code>adb shell dmesg > dmesg.txt</code></li>
                </ul>
                <p class="pt-2 italic text-gray-400 font-bold underline">Pastikan melakukan tes sebelum mengambil log!</p>
            </div>
            <button onclick="nextStep(3)" class="w-full bg-blue-600 p-3 rounded-lg font-bold hover:bg-blue-700">Mulai Ceklis Test</button>
            <button onclick="nextStep(1)" class="w-full text-gray-500 text-sm">Kembali</button>
        </div>

        <div id="step3" class="step-card space-y-4">
            <h2 class="text-xl font-semibold border-b border-gray-700 pb-2 text-green-400">3. Ceklis & Hasil</h2>
            <div id="checklistContainer" class="space-y-2 max-h-80 overflow-y-auto pr-2">
                </div>
            
            <div class="pt-4">
                <label class="block text-sm mb-2 font-bold text-blue-300 italic uppercase">Upload Log File (.txt atau .log)</label>
                <input type="file" id="logFile" class="w-full text-sm text-gray-400 file:bg-gray-700 file:text-white file:border-0 file:py-2 file:px-4 file:rounded-lg cursor-pointer">
            </div>

            <button onclick="generateZip()" class="w-full bg-green-600 p-3 rounded-lg font-bold mt-4 hover:bg-green-700 shadow-lg shadow-green-900/20">REKAP & DOWNLOAD .ZIP</button>
            <button onclick="resetData()" class="w-full text-red-500 text-xs mt-2 uppercase tracking-widest">Hapus Semua Progress</button>
        </div>

    </div>

    <script>
        const config = {
            "POCO F3": ["Wi-Fi", "Bluetooth", "120Hz Refresh Rate", "Dolby Atmos", "Proximity Sensor", "VoLTE", "Fingerprint"],
            "Redmi Note 10 Pro": ["Wi-Fi", "Bluetooth", "Camera 108MP", "Sound Stereo", "FM Radio", "Fast Charging", "SD Card"],
            "Umum": ["RIL / Sinyal", "Wi-Fi", "Bluetooth", "Kamera", "Audio", "Senter", "GPS", "Biometrik"]
        };

        function nextStep(step) {
            document.querySelectorAll('.step-card').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + step).classList.add('active');
            
            const titles = ["Identitas", "Persiapan Log", "Checklist Test"];
            document.getElementById('stepIndicator').innerText = `Langkah ${step}: ${titles[step-1]}`;
            if(step === 3) renderChecklist();
        }

        function renderChecklist() {
            const device = document.getElementById('deviceSelect').value;
            const container = document.getElementById('checklistContainer');
            const items = config[device] || config["Umum"];
            
            container.innerHTML = "";
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = "flex items-center justify-between bg-gray-700/50 p-3 rounded-lg border border-gray-600";
                div.innerHTML = `
                    <span class="text-sm font-medium">${item}</span>
                    <select class="test-result bg-gray-600 rounded p-1 text-xs" data-item="${item}" onchange="saveData()">
                        <option value="Working">✅ Working</option>
                        <option value="Bug">❌ Bug</option>
                        <option value="Not Tested">⚪ Not Tested</option>
                    </select>
                `;
                container.appendChild(div);
            });
            loadSavedResults();
        }

        // AUTO SAVE LOGIC
        function saveData() {
            const results = {};
            document.querySelectorAll('.test-result').forEach(el => {
                results[el.getAttribute('data-item')] = el.value;
            });

            const data = {
                tgUser: document.getElementById('tgUser').value,
                romName: document.getElementById('romName').value,
                device: document.getElementById('deviceSelect').value,
                testType: document.getElementById('testType').value,
                results: results
            };
            localStorage.setItem('android_test_data', JSON.stringify(data));
            
            // Show auto-save indicator
            const status = document.getElementById('autoSaveStatus');
            status.style.opacity = "1";
            setTimeout(() => status.style.opacity = "0", 1500);
        }

        function loadSavedResults() {
            const raw = localStorage.getItem('android_test_data');
            if(!raw) return;
            const data = JSON.parse(raw);
            document.querySelectorAll('.test-result').forEach(el => {
                const item = el.getAttribute('data-item');
                if(data.results[item]) el.value = data.results[item];
            });
        }

        function loadAllData() {
            const raw = localStorage.getItem('android_test_data');
            if(!raw) return;
            const data = JSON.parse(raw);
            document.getElementById('tgUser').value = data.tgUser || "";
            document.getElementById('romName').value = data.romName || "";
            document.getElementById('deviceSelect').value = data.device || "Umum";
            document.getElementById('testType').value = data.testType || "ROM";
        }

        async function generateZip() {
            const zip = new JSZip();
            const data = JSON.parse(localStorage.getItem('android_test_data'));
            const date = new Date().toISOString().split('T')[0];
            const logFile = document.getElementById('logFile').files[0];

            if(!data.romName) return alert("Isi nama ROM terlebih dahulu!");

            let report = `=== ANDROID TEST REPORT ===\n`;
            report += `Tester: ${data.tgUser || "N/A"}\n`;
            report += `Device: ${data.device}\n`;
            report += `Type: ${data.testType}\n`;
            report += `ROM: ${data.romName}\n`;
            report += `Tanggal: ${date}\n\n`;
            report += `--- HASIL TEST ---\n`;
            
            for (const [key, value] of Object.entries(data.results)) {
                report += `${key}: ${value}\n`;
            }

            zip.file("rekap_test.txt", report);
            if(logFile) zip.file(logFile.name, logFile);

            const content = await zip.generateAsync({type:"blob"});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(content);
            
            // Format Nama File: nama_rom-tanggal-jenis.zip
            const fileName = `${data.romName.replace(/\s+/g, '_')}-${date}-${data.testType.toLowerCase()}.zip`;
            link.download = fileName;
            link.click();
        }

        function resetData() {
            if(confirm("Hapus semua progress?")) {
                localStorage.clear();
                location.reload();
            }
        }

        window.onload = loadAllData;
        document.querySelectorAll('input, select').forEach(el => el.addEventListener('change', saveData));
    </script>
</body>
</html>
